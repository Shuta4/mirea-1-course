# Тема 4. Формы представления чисел: понятие разрядной сетки, формы с фиксированной и плавающей точкой, стандарт IEEE754, выполнение арифметических операций.
## Разрядная сетка
Разрядная сетка - множетсво двоичных разрядов, выделяемых в памяти компьютера для изображения чисел.

## Форма представления чисел
Форма представления чисел - вариант распределения разрядов имеющейся разрядной сетки между отдельными структурными элементами (полями) в записи числа.

Форма представления чисел:
- С фиксированной точкой:
	- Справа от младшего разряда:
		- Без знака (только положительные) (n разрядов, диапазон $0 <= X <= 2^n - 1$).
		- Со знаком (знаковый разряд, n - 1 разрядов):
			- Прямой код: $1 - 2^{n-1} <= X <= 2^{n-1} - 1$
			- Дополнительный код: $-2^{n-1} <= X <= 2^{n-1} - 1$
	- Где-то в середине сетки:
		- Без знака (только положительные) (k - целая часть, m - дробная часть, всего n разрядов ($n = k + m$))
		- Со знаком (знаковый разряд, p - целая часть, r - дробная часть, всего n ($n = p + r + 1$).
	- Слева от старшего разряда:
		- Без знака (только положительные) (n разр, диапазон $0 <= X <= 1 - 2^-n$
		- Со знаком (знаковый разряд, n - 1 разрядов, $0 <= |X| <= 1 - 2^{-(n-1)}$)
- С плавающей точкой:
	- Общая идея: `| Знаковый разряд порядка | Знаковый разряд мантиссы | Порядок (k) | Мантисса (m) |` (всего n разрядов (n = k+m+2)). Диапазон: $0 <= |X| <= (1-2^-m) * 2^{2^k - 1}$.
	- Для формы с плавающей точкой возникает множественность представлений одних и тех же чисел.
	- Нормализованный вид - способ избежать множественности представлений. Число считается нормализованным, если в старшем разряде после запятой стоит значащая цифра (в прямом коде двоичной системы - 1).

### Выполнение арифметических операций над числами с плавающей точкой
При сложении и вычитании чисел сначала производится выравнивание порядков (порядок меньшего по модулю числа увеличивается в сторону порядка большего по модулю числа, а мантисса меньшего по модулю числа сдвигается на соответствующее кол-во разрядов вправо, т.е. уменьшается в соответствующее кол-во раз), а затем производится сложение или вычитание мантисс.

При умножении чисел порядки складываются, а мантиссы перемножаются.

При делении из порядка делимого вычитается порядок делителя, а мантисса делимого делится на мантиссу делителя.

В конце арифметических операций при необходимости производится нормализация результата.

## Стандарт IEEE754
IEEE (Institute of Electrical and Electronics Engineers) - международная некоммерческая ассоциация инженеров, мировой лидер в области разработки стандартов по радиоэлектронике, электротехнике и аппаратному обеспечению вычислительных систем и сетей.

Стандарт IEEE754:
- 1985
- 2008 (используется чаще)

### Форматы стандарта
- Число половинной точности (разрядная сетка 2 байта)
- Число одинарной точности (4 байта)
- Число двойной точности (8 байт)
- Число четверичной точности (16 байт)

### Представление мантиссы
#### Нормализованная мантисса
Реализация нормализации отличается от общей идеи.

Стандарт определяет нормализованную мантиссу следующим образом: она состоит из неявной целой части, которая всегда равна 1 (но не хранится в памяти), двоичной точки и остальных разрядов, т.е. модуль нормализованной мантиссы охватывает диапазон чисел [1; 2). При этом мантисса хранится в прямом коде.

| 0, | 1 | 0 | 1 | 1 | 1 | 1 | 1 | 1     | 1     | Мантисса "классического" нормализованного числа |
| 1, | 0 | 1 | 1 | 1 | 0 | 1 | 1 | 1     | **0** |                                                 |
| ,0 | 1 | 1 | 1 | 0 | 1 | 1 | 1 | **0** | **0** | Отказ от хранения целой части                   |

Из-за отказа от хранения целой части, происходит выигрыш 2 бит в записи числа.

#### Ненормализованная мантисса
Если число не может быть сохранено в нормализованном виде, посколльу в рассматриваемом формате не хватает для этого порядка разрядов, то, возможно, его можно сохранить в ненормализованном виде. Стандарт определяет ненормализованную мантиссу следующим образом: она состоит из неявной целой части, которая всегда равна 0 (не хранится в памяти), двоичной точки и остальных разрядов. При этом мантисса хранится в прямом коде.

Получается, что модуль ненормализованной мантиссы охватывает диапазон чисел [0; 1).

| 0, | 0 | 0 | 0 | 1 | 1 | 1 | 1 | 1 | 1 | Мантисса "классического" ненормализованного числа |
| ,0 | 0 | 0 | 1 | 1 | 1 | 1 | 1 | 1 | 0 | Отказ от хранения целой части                     |

#### Нормализованный порядок
Порядок записывается в симметричном коде со смещением, чтобы порядок всегда был неотрицательным. Это упрощает выполнение операций сравнения и выравнивания порядков, и избавляет от знакового разряда порядка в структуре числа.

Истинный порядок может быть как положительным, так и отрицательным.

Минимальное нормализованное число имеет порядок, равный 1 в коде со смещением.
Максимальное нормализованное число имеет порядок, равный 2^k - 2 в коде со смещением, где k - кол-во разрядов в поле порядка.

#### Ненормализованный порядок
Если в поле порядка все разряды равны нулю, а мантисса не равна нулю, следовательно число ненормализованное.

В этом случае истинное значение порядка вычисляется так: 1 - смещение порядка для нормализованного числа, т.е. оно равно истинному порядку минимального (по модулю) нормализованного числа.

### Категории отображаемых значений с учетом спец случаев
| Тип числа               | Знак | Порядок     | Мантисса                    |
|-------------------------|------|-------------|-----------------------------|
| Нормализованное число   | +-   | 0 < E < max | Любой набор битов           |
| Ненормализованное число | +-   | 0           | Любой ненулевой набор битов |
| Ноль                    | +-   | 0           | 0                           |
| Бесконечность           | +-   | Все 1 (max) | 0                           |
| Не число                | +-   | Все 1 (max) | Любой ненулевой набор битов |

### Формат числа с половинной точностью
| Часть   | Знак | Порядок | Мантисса |
| Разряды | 15   | 14 - 10 | 9 - 0    |
Всего 16 разрядов

Сдвиг порядка = 15

#### Максимальное нормализованное число в формате ПТ
| Знак | Порядок |    | Мантисса    |
| 0    | 11110   | 1. | 11111111111 |
Порядок 11111 зарезервирован для бесконечности.
Истинный порядок: $30 - 15 = 15$

$1.1111111111_2 * 2^15 = 1111111111100000_2 = 65504_10$

#### Минимальное нормализованное число в формате ПТ
| Знак | Порядок |    | Мантисса    |
| 0    | 00001   | 1. | 00000000000 |
Истинный порядок: $1 - 15 = -14$

$1_2 * 2^-14 = 0.00000000000001_2 = 0.00006103515625_10$

#### Максимальноее ненормализованное число в формате ПТ
| Знак | Порядок |    | Мантисса    |
| 0    | 00000   | 0. | 11111111111 |
Истинный порядок: $1 - 15 = -14$

$0.1111111111_2 * 2^-14 = 0.000000000000001111111111_2 = 0.000060975551605224..._10$

#### Минимальное ненормализованное число в формате ПТ
| Знак | Порядок |    | Мантисса    |
| 0    | 00000   | 0. | 00000000001 |
Истинный порядок: $1 - 15 = -14$

$0.0000000001_2 * 2^-14 = 0.000000000000000000000001_2 = 0.000000059604644775390625_10$

Меньшие по модулю числа будут восприниматься как машинный ноль для данного формата.

### Проблема нарушения непрерывности представления числа на примере формата ПТ
| Знак | Порядок |    | Мантисса    |
| 0    | 01111   | 1. | 00000000000 |

| Знак | Порядок |    | Мантисса    |
| 0    | 01111   | 1. | 00000000001 |

Истинный порядок: $15 - 15 = 0$
$1_2 = 1_10$

$1.0000000001_2 = 1.0009765625_10$

$1_10 < X < 1.0009765625_10 => X = 1.0005$

$1.0005_10 = 1.00000000001..._2$

| Знак | Порядок |    | Мантисса   | Выпала |
| 0    | 01111   | 1. | 0000000000 | 1      |

В результате усечения младшего разряда произошла потеря точности и число уменьшилось.

### Ограничение точности для целых чисел
- От 0 до 2048 передаются как есть.
- От 2049 до 4096 усекаются до ближайшего четного целого
- От 4097 до 8192 усекаются до ближайшего целого, делящегося нацело на 4.
- От 8193 до 16384 усекаются до ближайшего целого, делящегося нацело на 8.

### Машинный ноль
Машинный ноль - числовое значение с таким отрицательным порядком, которое воспринимается машиной как ноль.

Для числа одинарной точности: $-2^-150 < Машинный 0 < 2^-150$

### Алгоритм перевода вещественного числа в формат IEEE754
1. Перевести число из системы K в двоичную.
2. Нормализовать число согласно требованиям стандарта и определить истинный порядок числа.
3. Выбрать один из форматов стандарта IEEE754.
4. Определить, возможно ли хранение числа нормализованным в выбранном формате (если нет, то лучше выбрать другой формат или придется записывать число как ненормализованное в выбранном формате).
5. Рассчитать смещенный порядок числа.
6. Разместить знак мантиссыы, смещенный порядок и мантиссу без целой части в соответствующие поля разрядной сетки.
7. Если нужно, то привести запись числа к 16-му виду.

### Алгоритм перевода вещественного числа из формата IEEE754
1. Привести запись числа из 16-го вида к 2-му.
2. Выделить содержимое полей (знак, порядок, мантисса) в соответствии с используемым форматом.
3. По содержимому порядка и мантисссы определить категорию, к которой принадлежит двоичная запись (нормализованное или ненормализованное число, бесконечность, ноль, не число)
4. Если число нормализованное, то:
	1. Вычислить истинный порядок.
	2. Образовать полную запись мантиссы, объединив подразумеваем3ую целую часть, равную 1, с дробной.
	3. Произвести умножение мантиссы на 2 в степени порядка и перевести результат в систему K.
5. Если число ненормализованное, то:
	1. Истинный порядок равен минимально возможному порядку для нормализованного числа в рассматриваемом формате.
	2. Образовать полную запись мантиссы, объединив подразумеваемую целую часть, равную 0, с дробной.
	3. Произвести умножение мантиссы на 2 в степени порядка и перевести результат в систему K.
